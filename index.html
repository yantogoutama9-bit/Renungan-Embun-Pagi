<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Renungan Embun Pagi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    colors: {
                        faith: {
                            50: '#fff7ed',
                            100: '#ffedd5',
                            200: '#fed7aa',
                            300: '#fdba74',
                            400: '#fb923c',
                            500: '#f97316',
                            600: '#ea580c',
                            700: '#c2410c',
                            800: '#9a3412',
                            900: '#7c2d12',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .glass-panel { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        .nav-item.active { color: #ea580c; border-bottom: 2px solid #ea580c; }
        .loading-spinner { border: 3px solid #f3f3f3; border-top: 3px solid #ea580c; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .quote-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .date-badge { 
            display: inline-block;
            background: #fed7aa;
            color: #c2410c;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-50 via-white to-blue-50 min-h-screen text-slate-800 font-sans">

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 glass-panel shadow-sm">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-sun text-faith-600 text-2xl"></i>
                    <span class="font-serif font-bold text-xl text-slate-900 tracking-tight">Embun<span class="text-faith-600">Pagi</span></span>
                </div>
                <div class="hidden md:flex space-x-6 text-sm font-medium text-slate-600">
                    <button onclick="switchTab('devotional')" id="nav-devotional" class="nav-item active hover:text-faith-600 transition-colors py-5">Renungan</button>
                    <button onclick="switchTab('quotes')" id="nav-quotes" class="nav-item hover:text-faith-600 transition-colors py-5">Quotes</button>
                    <button onclick="switchTab('worship')" id="nav-worship" class="nav-item hover:text-faith-600 transition-colors py-5">Lagu Rohani</button>
                    <button onclick="switchTab('prayer-support')" id="nav-prayer-support" class="nav-item hover:text-faith-600 transition-colors py-5 flex items-center gap-1">
                        <i class="fas fa-hands-praying text-xs"></i> Dukungan Doa
                    </button>
                </div>
                <div class="md:hidden flex items-center">
                    <button onclick="toggleMobileMenu()" class="text-slate-600 hover:text-faith-600">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100 absolute w-full">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <button onclick="switchTab('devotional')" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-faith-600 hover:bg-orange-50">Renungan</button>
                <button onclick="switchTab('quotes')" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-faith-600 hover:bg-orange-50">Quotes</button>
                <button onclick="switchTab('worship')" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-faith-600 hover:bg-orange-50">Lagu Rohani</button>
                <button onclick="switchTab('prayer-support')" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-faith-600 hover:bg-orange-50">Dukungan Doa</button>
            </div>
        </div>
    </nav>

    <main class="pt-24 pb-12 px-4 sm:px-6 max-w-5xl mx-auto min-h-screen">
        
        <!-- SECTION: RENUNGAN HARIAN -->
        <div id="section-devotional">
            <div class="text-center mb-10">
                <span class="inline-block py-1 px-3 rounded-full bg-faith-100 text-faith-700 text-xs font-bold uppercase mb-3" id="current-date-display">Memuat...</span>
                <h1 class="font-serif text-4xl md:text-5xl font-bold text-slate-900 mb-4">
                    Renungan untuk <span class="text-faith-600">Hari Ini</span>
                </h1>
            </div>

            <div id="devotional-loading" class="bg-white rounded-2xl shadow-xl p-8 mb-8">
                <div class="flex flex-col items-center justify-center py-8">
                    <div class="loading-spinner mb-4"></div>
                    <p class="text-slate-500">Menghubungkan ke server...</p>
                </div>
            </div>

            <div id="devotional-content" class="hidden bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-100 mb-8">
                <div class="h-2 bg-gradient-to-r from-faith-400 to-faith-600"></div>
                <div class="p-8 md:p-12">
                    <div class="flex flex-col md:flex-row gap-8">
                        <div class="md:w-1/3 flex flex-col justify-center border-b md:border-b-0 md:border-r border-slate-100 pb-8 md:pb-0 md:pr-8">
                            <i class="fas fa-quote-left text-4xl text-faith-200 mb-4"></i>
                            <h3 class="font-serif text-2xl font-bold text-slate-900 mb-2" id="devo-verse-ref">Memuat...</h3>
                            <p class="font-serif text-xl text-slate-700 italic leading-relaxed" id="devo-verse-text">"..."</p>
                            <button onclick="copyVerse()" class="mt-6 text-sm text-faith-600 hover:text-faith-800 font-medium flex items-center gap-2 self-start">
                                <i class="far fa-copy"></i> Salin Ayat
                            </button>
                        </div>
                        
                        <div class="md:w-2/3">
                            <h2 class="text-2xl font-bold text-slate-900 mb-4" id="devo-title">Memuat...</h2>
                            <div class="prose prose-slate prose-lg text-slate-600" id="devo-body">
                                <p>Memuat renungan...</p>
                            </div>
                            
                            <div class="mt-8 pt-6 border-t border-slate-100 flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-full bg-faith-100 flex items-center justify-center text-faith-600">
                                        <i class="fas fa-pen-nib"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-slate-900">Penulis</p>
                                        <p class="text-xs text-slate-500" id="devo-author">Renungan Harian®</p>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="shareDevotional()" class="p-2 rounded-full hover:bg-slate-100 text-slate-500 transition-colors">
                                        <i class="fas fa-share-alt"></i>
                                    </button>
                                    <button onclick="toggleLike(this)" class="p-2 rounded-full hover:bg-red-50 text-slate-500 hover:text-red-500 transition-colors">
                                        <i class="far fa-heart"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="devotional-error" class="hidden bg-red-50 border border-red-200 rounded-2xl p-8 text-center">
                <i class="fas fa-exclamation-circle text-4xl text-red-400 mb-4"></i>
                <h3 class="text-lg font-bold text-red-800 mb-2">Gagal Memuat</h3>
                <div class="flex gap-3 justify-center">
                    <button onclick="retryFetch()" class="px-6 py-2 bg-faith-600 text-white rounded-lg font-medium">
                        <i class="fas fa-sync-alt"></i> Coba Lagi
                    </button>
                    <button onclick="loadFallbackDevotional()" class="px-6 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50">
                        Offline Mode
                    </button>
                </div>
            </div>
        </div>

        <!-- SECTION: QUOTES FROM REHOBOT.ORG (PERBAIKAN TANGGAL) -->
        <div id="section-quotes" class="hidden">
            <div class="text-center mb-10">
                <span class="inline-block py-1 px-3 rounded-full bg-purple-100 text-purple-700 text-xs font-bold uppercase mb-3">Auto Update dari Rehobot.org</span>
                <h1 class="font-serif text-4xl font-bold text-slate-900 mb-4">Quotes <span class="text-faith-600">Kristen</span></h1>
                <p class="text-slate-500">Kutipan rohani yang diambil langsung dari Rehobot.org</p>
            </div>

            <div id="quotes-loading" class="flex justify-center items-center py-12">
                <div class="loading-spinner"></div>
            </div>

            <div id="quotes-error" class="hidden text-center py-8">
                <p class="text-red-600 mb-4">Gagal memuat quotes.</p>
                <button onclick="fetchRehobotQuotes()" class="px-6 py-2 bg-faith-600 text-white rounded-lg">
                    <i class="fas fa-sync-alt"></i> Coba Lagi
                </button>
            </div>

            <!-- Featured Quote -->
            <div id="featured-quote" class="hidden quote-card rounded-2xl p-8 md:p-12 text-white shadow-xl mb-8">
                <div class="relative z-10">
                    <div class="flex items-center gap-2 mb-4">
                        <span id="featured-date" class="date-badge">Tanggal</span>
                    </div>
                    <i class="fas fa-quote-left text-4xl text-white/30 mb-4 block"></i>
                    <p class="font-serif text-2xl md:text-3xl font-bold leading-relaxed mb-6" id="quote-text">...</p>
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center">
                            <i class="fas fa-user text-xl"></i>
                        </div>
                        <div>
                            <p class="font-bold text-lg" id="quote-author">Rehobot.org</p>
                            <p class="text-white/80 text-sm">Sumber: rehobot.org/category/quote</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quotes Grid -->
            <div id="quotes-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>

            <div class="mt-8 text-center">
                <button onclick="fetchRehobotQuotes()" class="px-8 py-3 bg-faith-600 text-white rounded-full font-medium hover:bg-faith-700 transition-all shadow-lg">
                    <i class="fas fa-sync-alt mr-2"></i> Refresh Quotes
                </button>
            </div>
        </div>

        <!-- SECTION: LAGU ROHANI (VIDEO STATIS YANG TERJAMIN) -->
        <div id="section-worship" class="hidden">
            <div class="text-center mb-10">
                <span class="inline-block py-1 px-3 rounded-full bg-blue-100 text-blue-700 text-xs font-bold uppercase mb-3">Koleksi Lagu Rohani</span>
                <h1 class="font-serif text-4xl font-bold text-slate-900 mb-4">Lagu Rohani <span class="text-faith-600">Pilihan</span></h1>
                <p class="text-slate-500">Kumpulan lagu rohani terbaik (diperbarui secara berkala)</p>
            </div>

            <div id="worship-grid" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Lagu rohani statis yang terjamin -->
            </div>

            <div class="mt-8 text-center">
                <button onclick="rotateWorshipSongs()" class="px-8 py-3 bg-faith-600 text-white rounded-full font-medium hover:bg-faith-700 transition-all shadow-lg">
                    <i class="fas fa-sync-alt mr-2"></i> Ganti Lagu
                </button>
            </div>
        </div>

        <!-- SECTION: DUKUNGAN DOA -->
        <div id="section-prayer-support" class="hidden">
            <div class="text-center mb-10">
                <span class="inline-block py-1 px-3 rounded-full bg-green-100 text-green-700 text-xs font-bold uppercase mb-3">Komunitas Doa</span>
                <h1 class="font-serif text-4xl font-bold text-slate-900 mb-4">Dukungan <span class="text-faith-600">Doa</span></h1>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-2xl shadow-xl p-8 border border-slate-100">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 rounded-full bg-faith-100 flex items-center justify-center text-faith-600">
                            <i class="fas fa-paper-plane"></i>
                        </div>
                        <h2 class="font-serif text-2xl font-bold text-slate-900">Kirim Permohonan Doa</h2>
                    </div>

                    <form id="prayer-form" class="space-y-4" onsubmit="submitPrayer(event)">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Nama Lengkap *</label>
                            <input type="text" id="prayer-name" required class="w-full px-4 py-3 rounded-lg border border-slate-200 focus:border-faith-500 focus:ring-2 focus:ring-faith-200 outline-none transition-all" placeholder="Masukkan nama Anda">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Email/WhatsApp</label>
                            <input type="text" id="prayer-contact" class="w-full px-4 py-3 rounded-lg border border-slate-200 focus:border-faith-500 focus:ring-2 focus:ring-faith-200 outline-none transition-all" placeholder="Untuk follow-up (opsional)">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Kategori *</label>
                            <select id="prayer-category" required class="w-full px-4 py-3 rounded-lg border border-slate-200 focus:border-faith-500 focus:ring-2 focus:ring-faith-200 outline-none transition-all">
                                <option value="Umum">Umum</option>
                                <option value="Kesembuhan">Kesembuhan</option>
                                <option value="Pekerjaan & Keuangan">Pekerjaan & Keuangan</option>
                                <option value="Keluarga & Pernikahan">Keluarga & Pernikahan</option>
                                <option value="Pendidikan">Pendidikan</option>
                                <option value="Lainnya">Lainnya</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Permohonan Doa *</label>
                            <textarea id="prayer-request" required rows="5" class="w-full px-4 py-3 rounded-lg border border-slate-200 focus:border-faith-500 focus:ring-2 focus:ring-faith-200 outline-none transition-all resize-none" placeholder="Tuliskan permohonan doa Anda di sini..."></textarea>
                        </div>

                        <button type="submit" id="submit-prayer-btn" class="w-full py-3 bg-faith-600 hover:bg-faith-700 text-white font-bold rounded-lg transition-all transform hover:scale-[1.02] flex items-center justify-center gap-2">
                            <i class="fas fa-paper-plane"></i>
                            <span>Kirim Permohonan Doa</span>
                        </button>

                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mt-4">
                            <p class="text-xs text-blue-800 text-center">
                                <i class="fas fa-info-circle mr-1"></i>
                                Akan dikirim ke: <strong>info.gerejaanugerahbaru@gmail.com</strong>
                            </p>
                        </div>
                    </form>

                    <div id="prayer-success" class="hidden text-center py-8">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center text-green-600 mx-auto mb-4">
                            <i class="fas fa-check text-2xl"></i>
                        </div>
                        <h3 class="font-bold text-xl text-slate-900 mb-2">Doa Anda Terkirim! ✓</h3>
                        <p class="text-slate-600 mb-4">Permohonan doa telah dikirim ke email tim doa.</p>
                        <button onclick="resetPrayerForm()" class="text-faith-600 hover:text-faith-800 font-medium">Kirim permohonan lain</button>
                    </div>
                </div>

                <div class="space-y-6">
                    <div class="bg-gradient-to-br from-faith-500 to-faith-700 rounded-2xl p-8 text-white shadow-xl">
                        <i class="fas fa-hands-praying text-4xl mb-4 opacity-80"></i>
                        <h3 class="font-serif text-2xl font-bold mb-3">"Berdoalah tanpa henti"</h3>
                        <p class="text-faith-100 mb-4">1 Tesalonika 5:17</p>
                    </div>
                    <div class="bg-blue-50 rounded-2xl p-6 border border-blue-100">
                        <h4 class="font-bold text-blue-900 mb-2 flex items-center gap-2">
                            <i class="fas fa-shield-alt text-blue-500"></i> Kerahasiaan Terjamin
                        </h4>
                        <p class="text-blue-800 text-sm">Setiap permohonan dijaga kerahasiaannya.</p>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <footer class="bg-slate-900 text-white py-12 mt-auto">
        <div class="max-w-5xl mx-auto px-4 text-center">
            <p>&copy; 2026 - Renungan Embun Pagi. All rights reserved.</p>
        </div>
    </footer>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-5 right-5 transform translate-y-20 opacity-0 transition-all duration-300 z-50 bg-slate-800 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3">
        <i class="fas fa-check-circle text-green-400"></i>
        <span id="toast-message">Notification</span>
    </div>

    <script>
        // --- CONFIG ---
        const RSS_FEED_URL = 'https://www.renunganharian.net/?format=feed&type=rss';
        const REHOBOT_URL = 'https://rehobot.org/category/quote/';
        const PRAYER_EMAIL = 'info.gerejaanugerahbaru@gmail.com';
        const CORS_PROXIES = [
            'https://corsproxy.io/?url=',
            'https://api.allorigins.win/get?url=',
            'https://api.codetabs.com/v1/proxy?quest='
        ];

        // DATABASE LAGU ROHANI (TERJAMIN BUKAN IKLAN)
        const worshipSongsDB = [
            { title: "Kemenangan Terjadi di Sini", artist: "JPCC Worship", id: "kJQP7kiw5Fk" },
            { title: "Ku Ada di Tempat Ini", artist: "Sari Simorangkir", id: "RgKAFK5djSk" },
            { title: "Sampai Akhir Hidupku", artist: "JPCC Worship", id: "9bZkp7q19f0" },
            { title: "Jadikan Hatiku Istana CintaMu", artist: "Franky Sihombing", id: "fJ9rUzIMcZQ" },
            { title: "Dengan Apa Kan Kubalas", artist: "Symphony Worship", id: "3RzR7kVyYMQ" },
            { title: "Hatiku Percaya", artist: "True Worshippers", id: "0uUz4lJlR2k" },
            { title: "BagiMu Segala Pujian", artist: "Sari Simorangkir", id: "sI9p70_Wc6o" },
            { title: "Kau Yang Terindah", artist: "JPCC Worship", id: "7z8z1b4z3z4" }
        ];

        let currentWorshipIndex = 0;

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date-display').textContent = new Date().toLocaleDateString('id-ID', dateOptions);
            fetchRSSDevotional();
            renderWorshipSongs();
        });

        // --- MULTI-PROXY FETCH ---
        async function fetchWithProxy(url, proxyIndex = 0) {
            if (proxyIndex >= CORS_PROXIES.length) throw new Error('All proxies failed');
            const proxy = CORS_PROXIES[proxyIndex];
            const fullUrl = proxy + encodeURIComponent(url);
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000);
                const response = await fetch(fullUrl, { signal: controller.signal });
                clearTimeout(timeoutId);
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                if (proxy.includes('allorigins')) {
                    const data = await response.json();
                    return data.contents;
                }
                return await response.text();
            } catch (error) {
                return fetchWithProxy(url, proxyIndex + 1);
            }
        }

        // --- RENUNGAN HARIAN ---
        async function fetchRSSDevotional() {
            try {
                const content = await fetchWithProxy(RSS_FEED_URL);
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(content, "application/xml");
                
                if (xmlDoc.querySelector('parsererror')) throw new Error('Invalid XML');
                
                const items = xmlDoc.querySelectorAll("item");
                if (items.length === 0) throw new Error('No items');
                
                const todayItem = items[0];
                const title = todayItem.querySelector("title")?.textContent || "Tanpa Judul";
                const link = todayItem.querySelector("link")?.textContent || "#";
                const description = todayItem.querySelector("description")?.textContent || "";
                
                const parsed = parseDevotionalContent(description);
                
                document.getElementById('devotional-loading').classList.add('hidden');
                document.getElementById('devotional-content').classList.remove('hidden');
                
                document.getElementById('devo-title').textContent = title;
                document.getElementById('devo-verse-ref').textContent = parsed.verseRef;
                document.getElementById('devo-verse-text').textContent = `"${parsed.verseText}"`;
                document.getElementById('devo-body').innerHTML = `<p>${parsed.content}</p><p class="mt-4"><a href="${link}" target="_blank" class="text-faith-600 hover:underline">Baca selengkapnya →</a></p>`;
                
            } catch (error) {
                console.error(error);
                document.getElementById('devotional-loading').classList.add('hidden');
                document.getElementById('devotional-error').classList.remove('hidden');
            }
        }

        function parseDevotionalContent(html) {
            const temp = document.createElement('div');
            temp.innerHTML = html;
            const text = temp.textContent;
            const verseMatch = text.match(/([12]?\s*[A-Za-z]+\s*\d+:\d+[-–]?\d*)/);
            const verseRef = verseMatch ? verseMatch[1] : "Ayat Hari Ini";
            const content = text.replace(/\s+/g, ' ').trim().substring(0, 500) + "...";
            const verseTextMatch = text.match(/"([^"]{20,200})"/);
            const verseText = verseTextMatch ? verseTextMatch[1] : "Firman Tuhan adalah pelita...";
            return { verseRef, verseText, content };
        }

        // --- REHOBOT QUOTES (PERBAIKAN PARSING TANGGAL) ---
        async function fetchRehobotQuotes() {
            document.getElementById('quotes-loading').classList.remove('hidden');
            document.getElementById('quotes-error').classList.add('hidden');
            document.getElementById('featured-quote').classList.add('hidden');
            document.getElementById('quotes-grid').innerHTML = '';
            
            try {
                const content = await fetchWithProxy(REHOBOT_URL);
                const parser = new DOMParser();
                const doc = parser.parseFromString(content, "text/html");
                
                // Cari article/posts dengan struktur yang benar
                const articles = doc.querySelectorAll('article, .post, .entry');
                const quotes = [];
                
                articles.forEach((article, index) => {
                    if (index >= 4) return; // Ambil 4 quotes saja
                    
                    // Cari tanggal - biasanya ada di meta atau header
                    let dateText = '';
                    const dateEl = article.querySelector('.entry-date, .published, time, .post-date');
                    if (dateEl) {
                        dateText = dateEl.textContent.trim();
                        // Bersihkan format tanggal yang berantakan
                        dateText = dateText.replace(/(\w+)\s+(\d{1,2}),?\s*(\d{4})/, '$1 $2, $3');
                    }
                    
                    // Cari judul/quote text
                    const titleEl = article.querySelector('.entry-title, .post-title, h2, h3');
                    const contentEl = article.querySelector('.entry-content, .post-content, p');
                    
                    let quoteText = '';
                    if (titleEl) quoteText = titleEl.textContent.trim();
                    else if (contentEl) quoteText = contentEl.textContent.trim().substring(0, 200);
                    
                    // Cari kategori/tags
                    let category = '';
                    const catEl = article.querySelector('.cat-links, .category, .tags');
                    if (catEl) {
                        category = catEl.textContent.trim();
                        // Hapus kata "Quotes" jika ada di akhir
                        category = category.replace(/Quotes$/i, '').trim();
                    }
                    
                    if (quoteText && quoteText.length > 10) {
                        quotes.push({
                            text: quoteText,
                            date: dateText || new Date().toLocaleDateString('id-ID', {day: 'numeric', month: 'long', year: 'numeric'}),
                            category: category || 'Quotes',
                            author: 'Rehobot.org'
                        });
                    }
                });
                
                // Jika tidak ada artikel yang ketemu, coba fallback ke selector lain
                if (quotes.length === 0) {
                    // Coba cari di div atau section lain
                    const possibleQuotes = doc.querySelectorAll('.quote, blockquote, .content');
                    possibleQuotes.forEach((el, idx) => {
                        if (idx >= 4) return;
                        const text = el.textContent.trim();
                        if (text.length > 20 && text.length < 300) {
                            quotes.push({
                                text: text,
                                date: new Date().toLocaleDateString('id-ID', {day: 'numeric', month: 'long', year: 'numeric'}),
                                category: 'Quotes',
                                author: 'Rehobot.org'
                            });
                        }
                    });
                }
                
                if (quotes.length === 0) throw new Error('No quotes found');
                
                displayRehobotQuotes(quotes);
                showToast("Quotes berhasil dimuat");
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('quotes-loading').classList.add('hidden');
                document.getElementById('quotes-error').classList.remove('hidden');
            }
        }

        function displayRehobotQuotes(quotes) {
            document.getElementById('quotes-loading').classList.add('hidden');
            document.getElementById('featured-quote').classList.remove('hidden');
            
            // Featured quote (yang pertama)
            const featured = quotes[0];
            document.getElementById('featured-date').textContent = featured.date;
            document.getElementById('quote-text').textContent = featured.text;
            document.getElementById('quote-author').textContent = featured.author;
            
            // Grid quotes (sisanya)
            const grid = document.getElementById('quotes-grid');
            grid.innerHTML = quotes.slice(1).map(q => `
                <div class="bg-white rounded-xl p-6 shadow-md border-l-4 border-faith-500 hover:shadow-lg transition-shadow">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="date-badge">${q.date}</span>
                        ${q.category ? `<span class="text-xs text-slate-500">• ${q.category}</span>` : ''}
                    </div>
                    <i class="fas fa-quote-left text-2xl text-faith-200 mb-3"></i>
                    <p class="text-slate-700 font-medium mb-4 leading-relaxed">${q.text}</p>
                    <div class="flex items-center gap-2 text-sm text-slate-500">
                        <span class="font-bold text-slate-700">${q.author}</span>
                    </div>
                </div>
            `).join('');
        }

        // --- LAGU ROHANI (STATIS YANG TERJAMIN) ---
        function renderWorshipSongs() {
            const grid = document.getElementById('worship-grid');
            const songsToShow = worshipSongsDB.slice(currentWorshipIndex, currentWorshipIndex + 4);
            
            // Jika kurang dari 4, ambil dari awal
            if (songsToShow.length < 4) {
                const remaining = 4 - songsToShow.length;
                songsToShow.push(...worshipSongsDB.slice(0, remaining));
            }
            
            grid.innerHTML = songsToShow.map(song => `
                <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-slate-100 hover:shadow-xl transition-all duration-300">
                    <div class="relative h-48 bg-slate-200 group cursor-pointer" onclick="window.open('https://www.youtube.com/watch?v=${song.id}', '_blank')">
                        <img src="https://img.youtube.com/vi/${song.id}/mqdefault.jpg" class="w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-opacity">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="w-16 h-16 bg-white/90 rounded-full flex items-center justify-center pl-1 shadow-lg group-hover:scale-110 transition-transform">
                                <i class="fas fa-play text-faith-600 text-2xl"></i>
                            </div>
                        </div>
                        <div class="absolute top-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded">
                            <i class="fab fa-youtube mr-1"></i>YouTube
                        </div>
                    </div>
                    <div class="p-4 bg-slate-50">
                        <h3 class="font-bold text-slate-800 truncate mb-1">${song.title}</h3>
                        <p class="text-sm text-slate-500">${song.artist}</p>
                    </div>
                </div>
            `).join('');
        }

        function rotateWorshipSongs() {
            currentWorshipIndex = (currentWorshipIndex + 4) % worshipSongsDB.length;
            renderWorshipSongs();
            showToast("Lagu diperbarui");
        }

        // --- FORM DOA (MAILTO LANGSUNG) ---
        function submitPrayer(e) {
            e.preventDefault();
            
            const btn = document.getElementById('submit-prayer-btn');
            const originalContent = btn.innerHTML;
            
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mengirim...';
            btn.disabled = true;
            
            const name = document.getElementById('prayer-name').value;
            const contact = document.getElementById('prayer-contact').value || 'Tidak disertakan';
            const category = document.getElementById('prayer-category').value;
            const request = document.getElementById('prayer-request').value;
            
            // Buat email dengan mailto (paling reliable, tidak perlu backend)
            const subject = `[Dukungan Doa] ${category} - ${name}`;
            const body = `Halo Tim Doa,

Ada permohonan doa baru:

NAMA: ${name}
KONTAK: ${contact}
KATEGORI: ${category}

PERMOHONAN DOA:
${request}

---
Dikirim dari aplikasi Renungan Embun Pagi
Tanggal: ${new Date().toLocaleString('id-ID')}`;

            // Buka email client
            window.location.href = `mailto:${PRAYER_EMAIL}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            // Tampilkan sukses (asumsi user akan kirim email)
            setTimeout(() => {
                document.getElementById('prayer-form').classList.add('hidden');
                document.getElementById('prayer-success').classList.remove('hidden');
                
                btn.innerHTML = originalContent;
                btn.disabled = false;
                
                showToast("Email dibuka. Silakan kirim dari aplikasi email Anda.");
            }, 1000);
        }

        function resetPrayerForm() {
            document.getElementById('prayer-form').reset();
            document.getElementById('prayer-form').classList.remove('hidden');
            document.getElementById('prayer-success').classList.add('hidden');
        }

        // --- UI UTILITIES ---
        function switchTab(tabName) {
            ['devotional', 'quotes', 'worship', 'prayer-support'].forEach(t => {
                document.getElementById(`section-${t}`).classList.add('hidden');
                document.getElementById(`nav-${t}`).classList.remove('active', 'text-faith-600', 'border-b-2', 'border-faith-600');
                document.getElementById(`nav-${t}`).classList.add('text-slate-600');
            });

            document.getElementById(`section-${tabName}`).classList.remove('hidden');
            const activeNav = document.getElementById(`nav-${tabName}`);
            activeNav.classList.add('active', 'text-faith-600');
            activeNav.classList.remove('text-slate-600');

            document.getElementById('mobile-menu').classList.add('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });

            if (tabName === 'quotes' && document.getElementById('quotes-grid').children.length === 0) {
                fetchRehobotQuotes();
            }
        }

        function toggleMobileMenu() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        }

        function copyVerse() {
            const text = document.getElementById('devo-verse-text').textContent + " - " + document.getElementById('devo-verse-ref').textContent;
            navigator.clipboard.writeText(text).then(() => showToast("Ayat disalin!"));
        }

        function shareDevotional() {
            if (navigator.share) {
                navigator.share({
                    title: document.getElementById('devo-title').textContent,
                    text: document.getElementById('devo-verse-text').textContent,
                    url: window.location.href
                });
            } else {
                showToast("Fitur share tersedia di mobile");
            }
        }

        function toggleLike(btn) {
            const icon = btn.querySelector('i');
            icon.classList.toggle('far');
            icon.classList.toggle('fas');
            icon.classList.toggle('text-red-500');
            showToast(icon.classList.contains('fas') ? "Ditambahkan ke favorit" : "Dihapus dari favorit");
        }

        function retryFetch() {
            document.getElementById('devotional-error').classList.add('hidden');
            document.getElementById('devotional-loading').classList.remove('hidden');
            fetchRSSDevotional();
        }

        function loadFallbackDevotional() {
            showToast("Menggunakan renungan cadangan");
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').textContent = message;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => toast.classList.add('translate-y-20', 'opacity-0'), 3000);
        }
    </script>
</body>
</html>
