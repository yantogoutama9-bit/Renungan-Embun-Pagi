name: Auto Update Portal Content

on:
  schedule:
    - cron: '0 22 * * *'   # 05.00 WIB setiap hari
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Update Renungan Harian
        run: |
          TODAY=$(date +"%d %B %Y")

          cat > data/renungan.json <<EOF
          [
            {
              "id": 1,
              "judul": "Renungan $TODAY",
              "tanggal": "$TODAY",
              "ringkasan": "Refleksi iman dan lagu pendukung hari ini.",
              "lagu_judul": "Bapa Engkau Sungguh Baik",
              "lagu_link": "https://www.youtube.com/results?search_query=Bapa+Engkau+Sungguh+Baik",
              "isi": "Iman yang dewasa dibangun melalui konsistensi.\n\nDoa, pembacaan Firman, dan refleksi pribadi membentuk karakter secara bertahap.\n\nMusik rohani membantu mengarahkan fokus hati pada kebenaran yang tetap.\n\nPertumbuhan sejati terlihat dari keputusan kecil yang setia setiap hari."
            }
          ]
          EOF

      - name: Update Kesaksian Mingguan
        run: |
          DAY=$(date +%u)
          if [ "$DAY" -eq 1 ]; then
            TODAY=$(date +"%d %B %Y")

            cat > data/kesaksian.json <<EOF
            [
              {
                "id": 1,
                "judul": "Kesaksian Transformasi - $TODAY",
                "ringkasan": "Perjalanan perubahan melalui proses yang nyata.",
                "lagu_judul": "Ku Percaya JanjiMu",
                "lagu_link": "https://www.youtube.com/results?search_query=Ku+Percaya+JanjiMu",
                "isi": "Transformasi hidup jarang terjadi secara instan.\n\nTekanan dan kegagalan sering menjadi alat pembentukan karakter.\n\nKomunitas dan konsistensi doa memberi stabilitas dalam proses.\n\nPerubahan sejati terlihat dari pola pikir dan tindakan yang berbeda dari masa lalu."
              }
            ]
            EOF
          fi

      - name: Commit and Push
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add data/renungan.json
          git add data/kesaksian.json
          git commit -m "Auto update content with song link" || echo "No changes"
          git push
